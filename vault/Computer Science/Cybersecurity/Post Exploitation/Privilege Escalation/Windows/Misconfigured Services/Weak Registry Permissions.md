# Weak Registry Permissions

As previously mentioned, each service is associated with a registry entry in the Windows Registry which is located at `HKLM\SYSTEM\CurrentControlSet\Services\<service>`. This entry is essentially the configuration of the service and if it is writable, then it can be abused by an adversary to overwrite the path to the binary application of the service with a malicious one.

![](res/Images/WRP/Modifiable%20Registry%20Service%20Entry.png)

Querying `regsvc` reveals that it is running with system privileges and its registry entry is writable by all logged-on users (`NT AUTHORITY\INTERACTIVE`).

![](res/Images/WRP/Query%20regsvc.png)

All we need to do now is overwrite the `ImagePath` registry key in the service's entry to point to our malicious executable:

```powershell
reg add HKLM\SYSTEM\CurrentControlSet\services\<service> /v ImagePath /t REG_EXPAND_SZ /d <path> /f
```

![](res/Images/WRP/Overwritten%20ImagePath%20Key.png)

Restart the service and catch the shell:
```powershell
net start regsvc
```

![](../res/Images/Shell.png)